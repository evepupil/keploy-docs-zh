---
id: samples-flask
title: 示例任务创建CRUD应用（Flask框架）
sidebar_label: Flask + Mongo
description: 以下示例应用展示了如何使用Flask框架和Keploy平台。
tags:
  - python
  - quickstart
  - samples
  - examples
  - tutorial
  - python-framework
  - mongodb
  - flask-framework
keyword:
  - Flask框架
  - MongoDB
  - NoSQL
  - Python
  - API测试生成器
  - 自动化用例生成
---

# 简介

🪄 深入学生CRUD应用的世界，看看Keploy如何与Flask和MongoDB无缝集成。系好安全带，这将是一段有趣的旅程！🎢

import InstallationGuide from '../concepts/installation.md'

<InstallationGuide/>

## 开始吧！🎬

## 克隆一个简单的学生管理API 🧪

```bash
git clone https://github.com/keploy/samples-python.git && cd samples-python/flask-mongo
```

## 安装Keploy

根据您的操作系统选择安装方式：

有两种方式可以运行此示例应用：

- [使用Docker compose：在Docker容器中运行应用和MongoDB](#使用docker-compose-)
- [使用Docker容器运行MongoDB并在本地运行应用](#在linuxwsl上本地运行应用-)

## 使用Docker Compose 🐳

我们将使用Docker compose在Docker容器中运行应用和MongoDB。

### 准备，开始，录制！🎥

捕获测试用例：

```shell
keploy record -c "docker compose up" --container-name "flask-app" --buildDelay 50
```

🔥**发起一些API调用**。可以使用Postman、Hoppscotch甚至curl——随您选择！

让我们简化URL：

### 生成测试用例

要生成测试用例，我们只需要**发起一些API调用**。

1. **发起POST请求：**

```bash
curl -X POST -H "Content-Type: application/json" -d '{"student_id": "12345", "name": "John Doe", "age": 20}' http://localhost:6000/students
```

2. **发起GET请求：**

```bash
curl http://localhost:6000/students
```

3. **发起PUT请求：**

```bash
curl -X PUT -H "Content-Type: application/json" -d '{"name": "Jane Smith", "age": 21}' http://localhost:6000/students/12345
```

4. **发起DELETE请求：**

```bash
curl -X DELETE http://localhost:6000/students/12345
```

完成后，您可以停止录制并为自己鼓掌！通过这个简单的操作，您已经生成了一个带有模拟的测试用例！探索**keploy**目录，您将在`tests`目录和`mocks.yml`中找到您的工作成果。

```yaml
# Generated by Keploy (2.4.16)
version: api.keploy.io/v1beta1
kind: Http
name: test-1
spec:
  metadata: {}
  req:
    method: POST
    proto_major: 1
    proto_minor: 1
    url: http://localhost:6000/students
    header:
      Accept: "*/*"
      Content-Length: "54"
      Content-Type: application/json
      Host: localhost:6000
      User-Agent: curl/8.7.1
    body: '{"student_id": "12345", "name": "John Doe", "age": 20}'
    timestamp: 2025-04-02T13:12:05.255523333Z
  resp:
    status_code: 200
    header:
      Content-Length: "48"
      Content-Type: application/json
      Date: Wed, 02 Apr 2025 13:12:05 GMT
      Server: Werkzeug/2.2.2 Python/3.9.21
    body: |
      {
        "message": "Student created successfully"
      }
    status_message: OK
    proto_major: 0
    proto_minor: 0
    timestamp: 2025-04-02T13:12:07.292707847Z
  objects: []
  assertions:
    noise:
      header.Date: []
  created: 1743599527
curl: |-
  curl --request POST \
    --url http://localhost:6000/students \
    --header 'Host: localhost:6000' \
    --header 'User-Agent: curl/8.7.1' \
    --header 'Accept: */*' \
    --header 'Content-Type: application/json' \
    --data "{\"student_id\": \"12345\", \"name\": \"John Doe\", \"age\": 20}"
```

这是`mocks.yml`的内容：

```yaml
version: api.keploy.io/v1beta1
kind: Mongo
name: mock-0
spec:
  metadata:
    operation: '{ OpQuery flags: [], fullCollectionName: admin.$cmd, numberToSkip: 0, numberToReturn: -1, query: {"ismaster": {"$numberInt":"1"},"helloOk": true,"client": {"driver": {"name": "PyMongo","version": "4.4.1"},"os": {"type": "Linux","name": "Linux","architecture": "aarch64","version": "6.1.0-32-cloud-arm64"},"platform": "CPython 3.9.21.final.0"}}, returnFieldsSelector:  }'
    type: config
  requests:
    - header:
        length: 269
        requestId: 846930886
        responseTo: 0
        Opcode: 2004
      message:
        flags: 0
        collection_name: admin.$cmd
        number_to_skip: 0
        number_to_return: -1
        query: '{"ismaster":{"$numberInt":"1"},"helloOk":true,"client":{"driver":{"name":"PyMongo","version":"4.4.1"},"os":{"type":"Linux","name":"Linux","architecture":"aarch64","version":"6.1.0-32-cloud-arm64"},"platform":"CPython 3.9.21.final.0"}}'
        return_fields_selector: ""
  responses:
    - header:
        length: 329
        requestId: 3
        responseTo: 846930886
        Opcode: 1
      message:
        response_flags: 8
        cursor_id: 0
        starting_from: 0
        number_returned: 1
        documents:
          - '{"helloOk":true,"ismaster":true,"topologyVersion":{"processId":{"$oid":"67ed3773a2f7dd8385defa99"},"counter":{"$numberLong":"0"}},"maxBsonObjectSize":{"$numberInt":"16777216"},"maxMessageSizeBytes":{"$numberInt":"48000000"},"maxWriteBatchSize":{"$numberInt":"100000"},"localTime":{"$date":{"$numberLong":"1743599485435"}},"logicalSessionTimeoutMinutes":{"$numberInt":"30"},"connectionId":{"$numberInt":"1"},"minWireVersion":{"$numberInt":"0"},"maxWireVersion":{"$numberInt":"25"},"readOnly":false,"ok":{"$numberDouble":"1.0"}}'
      read_delay: 990489
  created: 1743599485
  reqTimestampMock: 2025-04-02T13:11:25.434864042Z
  resTimestampMock: 2025-04-02T13:11:25.436114528Z
```

想看看一切是否如预期般工作吗？

### 运行测试

是时候进行测试了 🧪

```shell
keploy test -c "docker compose up" --container-name "flask-app" --buildDelay 50 --delay 10
```

> `--delay`标志？哦，那只是给您的应用在测试用例到来之前一点喘息的时间（以秒为单位）。

最后的想法？深入探索！尝试不同的API调用，调整`mocks.yml`中的数据库响应，或者修改`test-x.yml`中的请求或响应。再次运行测试，看看魔法如何展开！✨👩‍💻👨‍💻✨

### 总结 🎉

恭喜您完成这段旅程！您已经见识了Keploy的强大，锻炼了编码能力，还享受了一些乐趣！现在，继续探索、创新和创造吧！记住，有了正确的工具和一点乐趣，一切皆有可能。😊🚀

祝编码愉快！✨👩‍💻👨‍💻✨

## 在Linux/WSL上本地运行应用 🐧

我们将在Linux上直接运行我们的示例应用，但为了让事情更有趣一点，我们将让数据库（MongoDB）在Docker上运行。准备好了吗？让我们开始派对吧！🎉

## 安装所有依赖项

```bash
pip install -r requirements.txt
```

## 启动MongoDB服务器

```bash
sudo service mongod start
```

## 准备，开始，录制！🎥

要开始录制API调用，请在终端中执行以下命令：

```bash
keploy record -c "python3 app.py"
```

现在，您的应用将开始运行，您需要发起一些API调用来生成测试用例！！

1. **发起POST请求：**

```bash
curl -X POST -H "Content-Type: application/json" -d '{"student_id": "12345", "name": "John Doe", "age": 20}' http://localhost:6000/students
```

2. **发起GET请求：**

```bash
curl http://localhost:6000/students
```

3. **发起PUT请求：**

```bash
curl -X PUT -H "Content-Type: application/json" -d '{"name": "Jane Smith", "age": 21}' http://localhost:6000/students/12345
```

4. **发起DELETE请求：**

```bash
curl -X DELETE http://localhost:6000/students/12345
```

完成后，您可以停止录制并为自己鼓掌！通过这个简单的操作，您已经生成了一个带有模拟的测试用例！探索**keploy**目录，您将在`tests`目录和`mocks.yml`中找到您的工作成果。

```yaml
version: api.keploy.io/v1beta1
kind: Http
name: test-1
spec:
  metadata: {}
  req:
    method: POST
    proto_major: 1
    proto_minor: 1
    url: http://localhost:6000/students
    header:
      Accept: "*/*"
      Content-Length: "54"
      Content-Type: application/json
      Host: localhost:6000
      User-Agent: curl/8.7.1
    body: '{"student_id": "12345", "name": "John Doe", "age": 20}'
    timestamp: 2025-04-02T13:12:05.255523333Z
  resp:
    status_code: 200
    header:
      Content-Length: "48"
      Content-Type: application/json
      Date: Wed, 02 Apr 2025 13:12:05 GMT
      Server: Werkzeug/2.2.2 Python/3.9.21
    body: |
      {
        "message": "Student created successfully"
      }
    status_message: OK
    proto_major: 0
    proto_minor: 0
    timestamp: 2025-04-02T13:12:07.292707847Z
  objects: []
  assertions:
    noise:
      header.Date: []
  created: 1743599527
curl: |-
  curl --request POST \
    --url http://localhost:6000/students \
    --header 'Host: localhost:6000' \
    --header 'User-Agent: curl/8.7.1' \
    --header 'Accept: */*' \
    --header 'Content-Type: application/json' \
    --data "{\"student_id\": \"12345\", \"name\": \"John Doe\", \"age\": 20}"
```

这是`mocks.yml`的内容：

```yaml
version: api.keploy.io/v1beta1
kind: Mongo
name: mock-0
spec:
  metadata:
    operation: '{ OpQuery flags: [], fullCollectionName: admin.$cmd, numberToSkip: 0, numberToReturn: -1, query: {"ismaster": {"$numberInt":"1"},"helloOk": true,"client": {"driver": {"name": "PyMongo","version": "4.4.1"},"os": {"type": "Linux","name": "Linux","architecture": "aarch64","version": "6.1.0-32-cloud-arm64"},"platform": "CPython 3.9.21.final.0"}}, returnFieldsSelector:  }'
    type: config
  requests:
    - header:
        length: 269
        requestId: 846930886
        responseTo: 0
        Opcode: 2004
      message:
        flags: 0
        collection_name: admin.$cmd
        number_to_skip: 0
        number_to_return: -1
        query: '{"ismaster":{"$numberInt":"1"},"helloOk":true,"client":{"driver":{"name":"PyMongo","version":"4.4.1"},"os":{"type":"Linux","name":"Linux","architecture":"aarch64","version":"6.1.0-32-cloud-arm64"},"platform":"CPython 3.9.21.final.0"}}'
        return_fields_selector: ""
  responses:
    - header:
        length: 329
        requestId: 3
        responseTo: 846930886
        Opcode: 1
      message:
        response_flags: 8
        cursor_id: 0
        starting_from: 0
        number_returned: 1
        documents:
          - '{"helloOk":true,"ismaster":true,"topologyVersion":{"processId":{"$oid":"67ed3773a2f7dd8385defa99"},"counter":{"$numberLong":"0"}},"maxBsonObjectSize":{"$numberInt":"16777216"},"maxMessageSizeBytes":{"$numberInt":"48000000"},"maxWriteBatchSize":{"$numberInt":"100000"},"localTime":{"$date":{"$numberLong":"1743599485435"}},"logicalSessionTimeoutMinutes":{"$numberInt":"30"},"connectionId":{"$numberInt":"1"},"minWireVersion":{"$numberInt":"0"},"maxWireVersion":{"$numberInt":"25"},"readOnly":false,"ok":{"$numberDouble":"1.0"}}'
      read_delay: 990489
  created: 1743599485
  reqTimestampMock: 2025-04-02T13:11:25.434864042Z
  resTimestampMock: 2025-04-02T13:11:25.436114528Z
```

## 运行测试

现在，是时候进行测试了 🧪

```bash
keploy test -c "python3 app.py" --delay 10
```

现在，您还可以尝试不同的API调用，调整`mocks.yml`中的数据库响应，或者修改`test-x.yml`中的请求或响应。再次运行测试，看看魔法如何展开！

## 检查测试覆盖率

我们有一个`test-app.py`，其中编写了所有单元测试用例。现在使用Keploy，我们可以检查其代码覆盖率！！
要使用Keploy运行您的单元测试，可以运行以下命令：

```bash
python3 -m coverage run -p --data-file=.coverage.unit -m pytest -s test_keploy.py test_app.py
```

要合并来自单元测试和Keploy的API测试的覆盖率，可以使用以下命令：

```bash
python3 -m coverage combine
```

最后，要生成测试运行的覆盖率报告，可以运行：

```bash
python3 -m coverage report
```

如果您想要HTML格式的覆盖率报告，可以运行：

```bash
python3 -m coverage html
```

## 总结 🎉

恭喜您完成这段旅程！您已经见识了Keploy的强大，锻炼了编码能力，还享受了一些乐趣！现在，继续探索、创新和创造吧！记住，有了正确的工具和一点乐趣，一切皆有可能。😊🚀

希望这对您有所帮助，如果您还有任何问题，请联系我们。

import GetSupport from '../concepts/support.md'

<GetSupport/>