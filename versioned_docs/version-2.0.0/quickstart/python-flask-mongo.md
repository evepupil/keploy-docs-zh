---
id: samples-flask
title: ç¤ºä¾‹ä»»åŠ¡åˆ›å»ºCRUDåº”ç”¨ï¼ˆFlaskæ¡†æ¶ï¼‰
sidebar_label: Flask + Mongo
description: ä»¥ä¸‹ç¤ºä¾‹åº”ç”¨å±•ç¤ºäº†å¦‚ä½•ä½¿ç”¨Flaskæ¡†æ¶å’ŒKeployå¹³å°ã€‚
tags:
  - python
  - quickstart
  - samples
  - examples
  - tutorial
  - python-framework
  - mongodb
  - flask-framework
keyword:
  - Flaskæ¡†æ¶
  - MongoDB
  - NoSQL
  - Python
  - APIæµ‹è¯•ç”Ÿæˆå™¨
  - è‡ªåŠ¨åŒ–ç”¨ä¾‹ç”Ÿæˆ
---

# ç®€ä»‹

ğŸª„ æ·±å…¥å­¦ç”ŸCRUDåº”ç”¨çš„ä¸–ç•Œï¼Œçœ‹çœ‹Keployå¦‚ä½•ä¸Flaskå’ŒMongoDBæ— ç¼é›†æˆã€‚ç³»å¥½å®‰å…¨å¸¦ï¼Œè¿™å°†æ˜¯ä¸€æ®µæœ‰è¶£çš„æ—…ç¨‹ï¼ğŸ¢

import InstallationGuide from '../concepts/installation.md'

<InstallationGuide/>

## å¼€å§‹å§ï¼ğŸ¬

## å…‹éš†ä¸€ä¸ªç®€å•çš„å­¦ç”Ÿç®¡ç†API ğŸ§ª

```bash
git clone https://github.com/keploy/samples-python.git && cd samples-python/flask-mongo
```

## å®‰è£…Keploy

æ ¹æ®æ‚¨çš„æ“ä½œç³»ç»Ÿé€‰æ‹©å®‰è£…æ–¹å¼ï¼š

æœ‰ä¸¤ç§æ–¹å¼å¯ä»¥è¿è¡Œæ­¤ç¤ºä¾‹åº”ç”¨ï¼š

- [ä½¿ç”¨Docker composeï¼šåœ¨Dockerå®¹å™¨ä¸­è¿è¡Œåº”ç”¨å’ŒMongoDB](#ä½¿ç”¨docker-compose-)
- [ä½¿ç”¨Dockerå®¹å™¨è¿è¡ŒMongoDBå¹¶åœ¨æœ¬åœ°è¿è¡Œåº”ç”¨](#åœ¨linuxwslä¸Šæœ¬åœ°è¿è¡Œåº”ç”¨-)

## ä½¿ç”¨Docker Compose ğŸ³

æˆ‘ä»¬å°†ä½¿ç”¨Docker composeåœ¨Dockerå®¹å™¨ä¸­è¿è¡Œåº”ç”¨å’ŒMongoDBã€‚

### å‡†å¤‡ï¼Œå¼€å§‹ï¼Œå½•åˆ¶ï¼ğŸ¥

æ•è·æµ‹è¯•ç”¨ä¾‹ï¼š

```shell
keploy record -c "docker compose up" --container-name "flask-app" --buildDelay 50
```

ğŸ”¥**å‘èµ·ä¸€äº›APIè°ƒç”¨**ã€‚å¯ä»¥ä½¿ç”¨Postmanã€Hoppscotchç”šè‡³curlâ€”â€”éšæ‚¨é€‰æ‹©ï¼

è®©æˆ‘ä»¬ç®€åŒ–URLï¼š

### ç”Ÿæˆæµ‹è¯•ç”¨ä¾‹

è¦ç”Ÿæˆæµ‹è¯•ç”¨ä¾‹ï¼Œæˆ‘ä»¬åªéœ€è¦**å‘èµ·ä¸€äº›APIè°ƒç”¨**ã€‚

1. **å‘èµ·POSTè¯·æ±‚ï¼š**

```bash
curl -X POST -H "Content-Type: application/json" -d '{"student_id": "12345", "name": "John Doe", "age": 20}' http://localhost:6000/students
```

2. **å‘èµ·GETè¯·æ±‚ï¼š**

```bash
curl http://localhost:6000/students
```

3. **å‘èµ·PUTè¯·æ±‚ï¼š**

```bash
curl -X PUT -H "Content-Type: application/json" -d '{"name": "Jane Smith", "age": 21}' http://localhost:6000/students/12345
```

4. **å‘èµ·DELETEè¯·æ±‚ï¼š**

```bash
curl -X DELETE http://localhost:6000/students/12345
```

å®Œæˆåï¼Œæ‚¨å¯ä»¥åœæ­¢å½•åˆ¶å¹¶ä¸ºè‡ªå·±é¼“æŒï¼é€šè¿‡è¿™ä¸ªç®€å•çš„æ“ä½œï¼Œæ‚¨å·²ç»ç”Ÿæˆäº†ä¸€ä¸ªå¸¦æœ‰æ¨¡æ‹Ÿçš„æµ‹è¯•ç”¨ä¾‹ï¼æ¢ç´¢**keploy**ç›®å½•ï¼Œæ‚¨å°†åœ¨`tests`ç›®å½•å’Œ`mocks.yml`ä¸­æ‰¾åˆ°æ‚¨çš„å·¥ä½œæˆæœã€‚

```yaml
# Generated by Keploy (2.4.16)
version: api.keploy.io/v1beta1
kind: Http
name: test-1
spec:
  metadata: {}
  req:
    method: POST
    proto_major: 1
    proto_minor: 1
    url: http://localhost:6000/students
    header:
      Accept: "*/*"
      Content-Length: "54"
      Content-Type: application/json
      Host: localhost:6000
      User-Agent: curl/8.7.1
    body: '{"student_id": "12345", "name": "John Doe", "age": 20}'
    timestamp: 2025-04-02T13:12:05.255523333Z
  resp:
    status_code: 200
    header:
      Content-Length: "48"
      Content-Type: application/json
      Date: Wed, 02 Apr 2025 13:12:05 GMT
      Server: Werkzeug/2.2.2 Python/3.9.21
    body: |
      {
        "message": "Student created successfully"
      }
    status_message: OK
    proto_major: 0
    proto_minor: 0
    timestamp: 2025-04-02T13:12:07.292707847Z
  objects: []
  assertions:
    noise:
      header.Date: []
  created: 1743599527
curl: |-
  curl --request POST \
    --url http://localhost:6000/students \
    --header 'Host: localhost:6000' \
    --header 'User-Agent: curl/8.7.1' \
    --header 'Accept: */*' \
    --header 'Content-Type: application/json' \
    --data "{\"student_id\": \"12345\", \"name\": \"John Doe\", \"age\": 20}"
```

è¿™æ˜¯`mocks.yml`çš„å†…å®¹ï¼š

```yaml
version: api.keploy.io/v1beta1
kind: Mongo
name: mock-0
spec:
  metadata:
    operation: '{ OpQuery flags: [], fullCollectionName: admin.$cmd, numberToSkip: 0, numberToReturn: -1, query: {"ismaster": {"$numberInt":"1"},"helloOk": true,"client": {"driver": {"name": "PyMongo","version": "4.4.1"},"os": {"type": "Linux","name": "Linux","architecture": "aarch64","version": "6.1.0-32-cloud-arm64"},"platform": "CPython 3.9.21.final.0"}}, returnFieldsSelector:  }'
    type: config
  requests:
    - header:
        length: 269
        requestId: 846930886
        responseTo: 0
        Opcode: 2004
      message:
        flags: 0
        collection_name: admin.$cmd
        number_to_skip: 0
        number_to_return: -1
        query: '{"ismaster":{"$numberInt":"1"},"helloOk":true,"client":{"driver":{"name":"PyMongo","version":"4.4.1"},"os":{"type":"Linux","name":"Linux","architecture":"aarch64","version":"6.1.0-32-cloud-arm64"},"platform":"CPython 3.9.21.final.0"}}'
        return_fields_selector: ""
  responses:
    - header:
        length: 329
        requestId: 3
        responseTo: 846930886
        Opcode: 1
      message:
        response_flags: 8
        cursor_id: 0
        starting_from: 0
        number_returned: 1
        documents:
          - '{"helloOk":true,"ismaster":true,"topologyVersion":{"processId":{"$oid":"67ed3773a2f7dd8385defa99"},"counter":{"$numberLong":"0"}},"maxBsonObjectSize":{"$numberInt":"16777216"},"maxMessageSizeBytes":{"$numberInt":"48000000"},"maxWriteBatchSize":{"$numberInt":"100000"},"localTime":{"$date":{"$numberLong":"1743599485435"}},"logicalSessionTimeoutMinutes":{"$numberInt":"30"},"connectionId":{"$numberInt":"1"},"minWireVersion":{"$numberInt":"0"},"maxWireVersion":{"$numberInt":"25"},"readOnly":false,"ok":{"$numberDouble":"1.0"}}'
      read_delay: 990489
  created: 1743599485
  reqTimestampMock: 2025-04-02T13:11:25.434864042Z
  resTimestampMock: 2025-04-02T13:11:25.436114528Z
```

æƒ³çœ‹çœ‹ä¸€åˆ‡æ˜¯å¦å¦‚é¢„æœŸèˆ¬å·¥ä½œå—ï¼Ÿ

### è¿è¡Œæµ‹è¯•

æ˜¯æ—¶å€™è¿›è¡Œæµ‹è¯•äº† ğŸ§ª

```shell
keploy test -c "docker compose up" --container-name "flask-app" --buildDelay 50 --delay 10
```

> `--delay`æ ‡å¿—ï¼Ÿå“¦ï¼Œé‚£åªæ˜¯ç»™æ‚¨çš„åº”ç”¨åœ¨æµ‹è¯•ç”¨ä¾‹åˆ°æ¥ä¹‹å‰ä¸€ç‚¹å–˜æ¯çš„æ—¶é—´ï¼ˆä»¥ç§’ä¸ºå•ä½ï¼‰ã€‚

æœ€åçš„æƒ³æ³•ï¼Ÿæ·±å…¥æ¢ç´¢ï¼å°è¯•ä¸åŒçš„APIè°ƒç”¨ï¼Œè°ƒæ•´`mocks.yml`ä¸­çš„æ•°æ®åº“å“åº”ï¼Œæˆ–è€…ä¿®æ”¹`test-x.yml`ä¸­çš„è¯·æ±‚æˆ–å“åº”ã€‚å†æ¬¡è¿è¡Œæµ‹è¯•ï¼Œçœ‹çœ‹é­”æ³•å¦‚ä½•å±•å¼€ï¼âœ¨ğŸ‘©â€ğŸ’»ğŸ‘¨â€ğŸ’»âœ¨

### æ€»ç»“ ğŸ‰

æ­å–œæ‚¨å®Œæˆè¿™æ®µæ—…ç¨‹ï¼æ‚¨å·²ç»è§è¯†äº†Keployçš„å¼ºå¤§ï¼Œé”»ç‚¼äº†ç¼–ç èƒ½åŠ›ï¼Œè¿˜äº«å—äº†ä¸€äº›ä¹è¶£ï¼ç°åœ¨ï¼Œç»§ç»­æ¢ç´¢ã€åˆ›æ–°å’Œåˆ›é€ å§ï¼è®°ä½ï¼Œæœ‰äº†æ­£ç¡®çš„å·¥å…·å’Œä¸€ç‚¹ä¹è¶£ï¼Œä¸€åˆ‡çš†æœ‰å¯èƒ½ã€‚ğŸ˜ŠğŸš€

ç¥ç¼–ç æ„‰å¿«ï¼âœ¨ğŸ‘©â€ğŸ’»ğŸ‘¨â€ğŸ’»âœ¨

## åœ¨Linux/WSLä¸Šæœ¬åœ°è¿è¡Œåº”ç”¨ ğŸ§

æˆ‘ä»¬å°†åœ¨Linuxä¸Šç›´æ¥è¿è¡Œæˆ‘ä»¬çš„ç¤ºä¾‹åº”ç”¨ï¼Œä½†ä¸ºäº†è®©äº‹æƒ…æ›´æœ‰è¶£ä¸€ç‚¹ï¼Œæˆ‘ä»¬å°†è®©æ•°æ®åº“ï¼ˆMongoDBï¼‰åœ¨Dockerä¸Šè¿è¡Œã€‚å‡†å¤‡å¥½äº†å—ï¼Ÿè®©æˆ‘ä»¬å¼€å§‹æ´¾å¯¹å§ï¼ğŸ‰

## å®‰è£…æ‰€æœ‰ä¾èµ–é¡¹

```bash
pip install -r requirements.txt
```

## å¯åŠ¨MongoDBæœåŠ¡å™¨

```bash
sudo service mongod start
```

## å‡†å¤‡ï¼Œå¼€å§‹ï¼Œå½•åˆ¶ï¼ğŸ¥

è¦å¼€å§‹å½•åˆ¶APIè°ƒç”¨ï¼Œè¯·åœ¨ç»ˆç«¯ä¸­æ‰§è¡Œä»¥ä¸‹å‘½ä»¤ï¼š

```bash
keploy record -c "python3 app.py"
```

ç°åœ¨ï¼Œæ‚¨çš„åº”ç”¨å°†å¼€å§‹è¿è¡Œï¼Œæ‚¨éœ€è¦å‘èµ·ä¸€äº›APIè°ƒç”¨æ¥ç”Ÿæˆæµ‹è¯•ç”¨ä¾‹ï¼ï¼

1. **å‘èµ·POSTè¯·æ±‚ï¼š**

```bash
curl -X POST -H "Content-Type: application/json" -d '{"student_id": "12345", "name": "John Doe", "age": 20}' http://localhost:6000/students
```

2. **å‘èµ·GETè¯·æ±‚ï¼š**

```bash
curl http://localhost:6000/students
```

3. **å‘èµ·PUTè¯·æ±‚ï¼š**

```bash
curl -X PUT -H "Content-Type: application/json" -d '{"name": "Jane Smith", "age": 21}' http://localhost:6000/students/12345
```

4. **å‘èµ·DELETEè¯·æ±‚ï¼š**

```bash
curl -X DELETE http://localhost:6000/students/12345
```

å®Œæˆåï¼Œæ‚¨å¯ä»¥åœæ­¢å½•åˆ¶å¹¶ä¸ºè‡ªå·±é¼“æŒï¼é€šè¿‡è¿™ä¸ªç®€å•çš„æ“ä½œï¼Œæ‚¨å·²ç»ç”Ÿæˆäº†ä¸€ä¸ªå¸¦æœ‰æ¨¡æ‹Ÿçš„æµ‹è¯•ç”¨ä¾‹ï¼æ¢ç´¢**keploy**ç›®å½•ï¼Œæ‚¨å°†åœ¨`tests`ç›®å½•å’Œ`mocks.yml`ä¸­æ‰¾åˆ°æ‚¨çš„å·¥ä½œæˆæœã€‚

```yaml
version: api.keploy.io/v1beta1
kind: Http
name: test-1
spec:
  metadata: {}
  req:
    method: POST
    proto_major: 1
    proto_minor: 1
    url: http://localhost:6000/students
    header:
      Accept: "*/*"
      Content-Length: "54"
      Content-Type: application/json
      Host: localhost:6000
      User-Agent: curl/8.7.1
    body: '{"student_id": "12345", "name": "John Doe", "age": 20}'
    timestamp: 2025-04-02T13:12:05.255523333Z
  resp:
    status_code: 200
    header:
      Content-Length: "48"
      Content-Type: application/json
      Date: Wed, 02 Apr 2025 13:12:05 GMT
      Server: Werkzeug/2.2.2 Python/3.9.21
    body: |
      {
        "message": "Student created successfully"
      }
    status_message: OK
    proto_major: 0
    proto_minor: 0
    timestamp: 2025-04-02T13:12:07.292707847Z
  objects: []
  assertions:
    noise:
      header.Date: []
  created: 1743599527
curl: |-
  curl --request POST \
    --url http://localhost:6000/students \
    --header 'Host: localhost:6000' \
    --header 'User-Agent: curl/8.7.1' \
    --header 'Accept: */*' \
    --header 'Content-Type: application/json' \
    --data "{\"student_id\": \"12345\", \"name\": \"John Doe\", \"age\": 20}"
```

è¿™æ˜¯`mocks.yml`çš„å†…å®¹ï¼š

```yaml
version: api.keploy.io/v1beta1
kind: Mongo
name: mock-0
spec:
  metadata:
    operation: '{ OpQuery flags: [], fullCollectionName: admin.$cmd, numberToSkip: 0, numberToReturn: -1, query: {"ismaster": {"$numberInt":"1"},"helloOk": true,"client": {"driver": {"name": "PyMongo","version": "4.4.1"},"os": {"type": "Linux","name": "Linux","architecture": "aarch64","version": "6.1.0-32-cloud-arm64"},"platform": "CPython 3.9.21.final.0"}}, returnFieldsSelector:  }'
    type: config
  requests:
    - header:
        length: 269
        requestId: 846930886
        responseTo: 0
        Opcode: 2004
      message:
        flags: 0
        collection_name: admin.$cmd
        number_to_skip: 0
        number_to_return: -1
        query: '{"ismaster":{"$numberInt":"1"},"helloOk":true,"client":{"driver":{"name":"PyMongo","version":"4.4.1"},"os":{"type":"Linux","name":"Linux","architecture":"aarch64","version":"6.1.0-32-cloud-arm64"},"platform":"CPython 3.9.21.final.0"}}'
        return_fields_selector: ""
  responses:
    - header:
        length: 329
        requestId: 3
        responseTo: 846930886
        Opcode: 1
      message:
        response_flags: 8
        cursor_id: 0
        starting_from: 0
        number_returned: 1
        documents:
          - '{"helloOk":true,"ismaster":true,"topologyVersion":{"processId":{"$oid":"67ed3773a2f7dd8385defa99"},"counter":{"$numberLong":"0"}},"maxBsonObjectSize":{"$numberInt":"16777216"},"maxMessageSizeBytes":{"$numberInt":"48000000"},"maxWriteBatchSize":{"$numberInt":"100000"},"localTime":{"$date":{"$numberLong":"1743599485435"}},"logicalSessionTimeoutMinutes":{"$numberInt":"30"},"connectionId":{"$numberInt":"1"},"minWireVersion":{"$numberInt":"0"},"maxWireVersion":{"$numberInt":"25"},"readOnly":false,"ok":{"$numberDouble":"1.0"}}'
      read_delay: 990489
  created: 1743599485
  reqTimestampMock: 2025-04-02T13:11:25.434864042Z
  resTimestampMock: 2025-04-02T13:11:25.436114528Z
```

## è¿è¡Œæµ‹è¯•

ç°åœ¨ï¼Œæ˜¯æ—¶å€™è¿›è¡Œæµ‹è¯•äº† ğŸ§ª

```bash
keploy test -c "python3 app.py" --delay 10
```

ç°åœ¨ï¼Œæ‚¨è¿˜å¯ä»¥å°è¯•ä¸åŒçš„APIè°ƒç”¨ï¼Œè°ƒæ•´`mocks.yml`ä¸­çš„æ•°æ®åº“å“åº”ï¼Œæˆ–è€…ä¿®æ”¹`test-x.yml`ä¸­çš„è¯·æ±‚æˆ–å“åº”ã€‚å†æ¬¡è¿è¡Œæµ‹è¯•ï¼Œçœ‹çœ‹é­”æ³•å¦‚ä½•å±•å¼€ï¼

## æ£€æŸ¥æµ‹è¯•è¦†ç›–ç‡

æˆ‘ä»¬æœ‰ä¸€ä¸ª`test-app.py`ï¼Œå…¶ä¸­ç¼–å†™äº†æ‰€æœ‰å•å…ƒæµ‹è¯•ç”¨ä¾‹ã€‚ç°åœ¨ä½¿ç”¨Keployï¼Œæˆ‘ä»¬å¯ä»¥æ£€æŸ¥å…¶ä»£ç è¦†ç›–ç‡ï¼ï¼
è¦ä½¿ç”¨Keployè¿è¡Œæ‚¨çš„å•å…ƒæµ‹è¯•ï¼Œå¯ä»¥è¿è¡Œä»¥ä¸‹å‘½ä»¤ï¼š

```bash
python3 -m coverage run -p --data-file=.coverage.unit -m pytest -s test_keploy.py test_app.py
```

è¦åˆå¹¶æ¥è‡ªå•å…ƒæµ‹è¯•å’ŒKeployçš„APIæµ‹è¯•çš„è¦†ç›–ç‡ï¼Œå¯ä»¥ä½¿ç”¨ä»¥ä¸‹å‘½ä»¤ï¼š

```bash
python3 -m coverage combine
```

æœ€åï¼Œè¦ç”Ÿæˆæµ‹è¯•è¿è¡Œçš„è¦†ç›–ç‡æŠ¥å‘Šï¼Œå¯ä»¥è¿è¡Œï¼š

```bash
python3 -m coverage report
```

å¦‚æœæ‚¨æƒ³è¦HTMLæ ¼å¼çš„è¦†ç›–ç‡æŠ¥å‘Šï¼Œå¯ä»¥è¿è¡Œï¼š

```bash
python3 -m coverage html
```

## æ€»ç»“ ğŸ‰

æ­å–œæ‚¨å®Œæˆè¿™æ®µæ—…ç¨‹ï¼æ‚¨å·²ç»è§è¯†äº†Keployçš„å¼ºå¤§ï¼Œé”»ç‚¼äº†ç¼–ç èƒ½åŠ›ï¼Œè¿˜äº«å—äº†ä¸€äº›ä¹è¶£ï¼ç°åœ¨ï¼Œç»§ç»­æ¢ç´¢ã€åˆ›æ–°å’Œåˆ›é€ å§ï¼è®°ä½ï¼Œæœ‰äº†æ­£ç¡®çš„å·¥å…·å’Œä¸€ç‚¹ä¹è¶£ï¼Œä¸€åˆ‡çš†æœ‰å¯èƒ½ã€‚ğŸ˜ŠğŸš€

å¸Œæœ›è¿™å¯¹æ‚¨æœ‰æ‰€å¸®åŠ©ï¼Œå¦‚æœæ‚¨è¿˜æœ‰ä»»ä½•é—®é¢˜ï¼Œè¯·è”ç³»æˆ‘ä»¬ã€‚

import GetSupport from '../concepts/support.md'

<GetSupport/>